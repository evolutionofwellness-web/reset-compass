<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>The Reset Compass ‚Ä¢ v1.0.5</title>

<!-- PWA -->
<link rel="manifest" href="manifest.webmanifest?v=105">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="theme-color" content="#1C3B34"/>

<!-- Meta -->
<meta name="description" content="Choose your mode and get quick, realistic steps that match your energy today. Take your health into your own hands immediately.">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta http-equiv="Permissions-Policy" content="interest-cohort=()">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

<!-- Social preview -->
<meta property="og:title" content="The Reset Compass">
<meta property="og:description" content="Quick, realistic steps that match your energy today.">
<meta property="og:type" content="website">
<meta property="og:image" content="icons/icon-512.png">

<!-- Analytics (Plausible) -->
<script async defer data-domain="reset.evolutionofwellness.com" src="https://plausible.io/js/script.js?v=105"></script>

<style>
:root{
  --brand:#1C3B34; --beige:#F0E8D9; --ink:#1A1A1A; --muted:#6b6b6b; --border:#e7e7e7;
  --surv:#A94747; --drift:#E6B450; --ground:#3B755F; --grow:#4C7EDC;
}
*{box-sizing:border-box}
html{-webkit-tap-highlight-color:transparent}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;background:#fff;color:var(--ink)}
a,button{outline-offset:3px}
a:focus-visible,button:focus-visible{outline:2px solid #0a7f63}

header{position:sticky;top:0;background:var(--brand);color:#fff;padding:12px 16px;z-index:5}
header h1{margin:0;font-size:16px;line-height:1;text-align:center}
.nav{display:flex;gap:8px;justify-content:center;margin-top:8px;flex-wrap:wrap}
.nav a,.nav button.install-btn{
  color:#fff;text-decoration:none;opacity:.9;padding:6px 10px;border-radius:999px;border:1px solid transparent;
  background:transparent;font:inherit;cursor:pointer
}
.nav a.active{opacity:1;border-color:#fff}
.nav button.install-btn{border-color:#fff;opacity:1}

.wrap{max-width:860px;margin:0 auto;padding:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.card h3{margin:.2rem 0 .3rem}
.pill{display:inline-flex;align-items:center;gap:6px;background:var(--beige);color:var(--brand);padding:4px 8px;border-radius:999px;font-size:12px}
.btn{display:inline-block;background:var(--brand);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:700;text-decoration:none;cursor:pointer;touch-action:manipulation}
.btn.ghost{background:transparent;color:var(--brand);border:2px solid var(--brand)}
.btn.subtle{background:#eef1f0;color:var(--brand)}
footer{padding:24px;color:#666;text-align:center;font-size:12px}
textarea,input[type="text"]{width:100%;border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:16px;background:#fff}
textarea{min-height:92px;resize:vertical}

/* Compass */
.compass-wrap{display:flex;flex-direction:column;align-items:center}
svg.compass{width:340px;max-width:92vw;height:auto;display:block}
.compass text{font-weight:800;letter-spacing:.2px}
.center-tip{color:var(--muted);text-align:center;font-size:14px;margin:6px 0 12px}
.wedge{transition:opacity .15s ease, filter .15s ease; cursor:pointer}
.wedge:active{opacity:.28;filter:saturate(1.2)}

/* Mode buttons */
.mode-buttons{display:grid;grid-template-columns:repeat(2,minmax(140px,1fr));gap:10px;max-width:420px;margin:0 auto 8px}
.mode-btn{display:flex;align-items:center;justify-content:center;border-radius:12px;padding:12px 10px;font-weight:700;border:2px solid transparent;cursor:pointer;touch-action:manipulation}
.mode-btn span{font-size:16px}
.mode-btn.surv{background:#F7E5E5;border-color:var(--surv);color:var(--surv)}
.mode-btn.drift{background:#FFF0D5;border-color:var(--drift);color:var(--drift)}
.mode-btn.ground{background:#E6F0EC;border-color:var(--ground);color:var(--ground)}
.mode-btn.grow{background:#E6EEFF;border-color:var(--grow);color:var(--grow)}
.mode-btn:active{transform:scale(.98)}

/* Instruction panel */
.instructions{max-width:520px;margin:12px auto 4px;border-left:4px solid var(--brand);padding:12px 14px;background:#fafafa;border-radius:8px}
.instructions h2{margin:0 0 6px;font-size:20px;color:var(--brand)}
.instructions p{margin:4px 0 8px}

/* Stats bar */
.stats{display:flex;gap:10px;justify-content:center;align-items:center;margin:8px auto 4px;flex-wrap:wrap}
.stat{background:#f6f9f8;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:13px;color:var(--brand)}

/* Welcome, Toasts, History */
#popup{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:10}
#popup .box{background:#fff;color:var(--brand);padding:22px;border-radius:12px;max-width:340px;text-align:center;border:1px solid var(--border)}
#popup .box p{margin:.5rem 0}
#toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#1c3b34;color:#fff;padding:10px 14px;border-radius:999px;font-size:14px;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:9}
#toast.show{opacity:1}

.filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
.badge{display:inline-block;border:1px solid var(--border);padding:3px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
.log-item{border-bottom:1px dashed var(--border);padding:10px 0}
.log-item:last-child{border-bottom:0}
.note{white-space:pre-wrap}

/* Sticky back bar */
.sticky-back{position:sticky;bottom:-1px;background:#fff;border-top:1px solid var(--border);padding:10px;display:flex;justify-content:center;z-index:3}
</style>
</head>
<body>
<header role="banner">
  <h1>The Reset Compass</h1>
  <div class="nav" role="navigation" aria-label="Primary">
    <a id="nav-home" href="#/home">Compass</a>
    <a id="nav-wins" href="#/wins">Quick Wins</a>
    <a id="nav-history" href="#/history">History</a>
    <a id="nav-about" href="#/about">About</a>
    <button class="install-btn" id="installBtn" hidden aria-label="Install app">Install</button>
  </div>
</header>

<div class="wrap" id="app" role="main"></div>
<div id="toast" role="status" aria-live="polite"></div>

<footer>¬© 2025 Evolution of Wellness LLC ‚Ä¢ v1.0.5 ‚Ä¢ For educational purposes only. Not medical advice.</footer>

<script type="module">
/* ---------- DATA ---------- */
const Modes=[{id:1,name:'Surviving',desc:"Running on empty. Use the simplest steps to feel better.",color:'#A94747',icon:'ü©∫'},
{id:2,name:'Drifting',desc:'Okay but unfocused. Reconnect with what matters.',color:'#E6B450',icon:'üß≠'},
{id:3,name:'Grounded',desc:'Steady. Keep your rhythm without burnout.',color:'#3B755F',icon:'üåø'},
{id:4,name:'Growing',desc:'High energy. Move forward with intent.',color:'#4C7EDC',icon:'üöÄ'}];

const Tools=[
{id:1,mode_id:1,name:'3-Minute Reset',tag:'Quick mental and physical reboot',icon:'‚è±Ô∏è',summary:'Interrupt shutdown with one fast, full-body reset.',instructions:'1) Pause. 2) Breathe in 3s and out 6s for 2 minutes. 3) Seated reach and gentle twist for 1 minute.'},
{id:2,mode_id:1,name:'Bare Minimum Menu',tag:'Eat simply when energy is low',icon:'üçé',summary:'Choose 1 protein, 1 carb, and 1 fruit or veg you already have.',instructions:'Examples: eggs and toast with an apple. Yogurt and granola with berries. Rotisserie chicken with rice and a bagged salad. Pick one and eat.'},
{id:3,mode_id:1,name:'Energy Budget',tag:'Spend your energy wisely',icon:'‚ö°',summary:'Split today into Must, Might, and No. Protect your fuel.',instructions:'Fill Must first with up to three items. If energy rises, do one Might. Everything else is No today.'},
{id:4,mode_id:2,name:'Attention Anchor',tag:'Refocus scattered energy',icon:'üéØ',summary:'Pick one word for how you want to feel today.',instructions:'Choose a word like Calm, Clear, Steady, Present, or Light. Say it out loud. Return to it when distracted.'},
{id:5,mode_id:2,name:'Daily Reconnect',tag:'One prompt, one minute',icon:'üìù',summary:'Stay present with one honest sentence.',instructions:'Pick a prompt like ‚ÄúWhat gave me energy?‚Äù ‚ÄúWhat felt easiest?‚Äù or ‚ÄúWhat did I avoid?‚Äù Say or write one line.'},
{id:6,mode_id:2,name:'Weekly Waypoint',tag:'Give your week direction',icon:'üìÖ',summary:'A five-minute reset on your natural week start.',instructions:'1) Name your current mode. 2) Choose one weekly anchor like outside three times. 3) Set a reminder for next check-in.'},
{id:7,mode_id:3,name:'Energy Multiplier',tag:'Get more from what works',icon:'üîã',summary:'Identify one to three actions that give you energy and repeat them.',instructions:'List what already helps like sunlight, a short walk, or earlier lights. Repeat daily this week.'},
{id:8,mode_id:3,name:'Habit Reflector',tag:'Notice what‚Äôs working',icon:'ü™û',summary:'A short weekly scan to protect helpful routines.',instructions:'Write: what felt good, a pattern to repeat, and what throws me off. Add one guardrail.'},
{id:9,mode_id:3,name:'Keystone Builder',tag:'One small habit, big ripple',icon:'üß±',summary:'Choose one keystone habit and make it automatic.',instructions:'Use: After I [trigger], I will [habit] in [location]. Check it off each day.'},
{id:10,mode_id:3,name:'Boundary Booster',tag:'Protect energy and focus',icon:'üõ°Ô∏è',summary:'Keep growth from getting hijacked by distractions.',instructions:'Pick three priorities and two mini boundaries. Write a reminder: ‚ÄúMy energy is worth protecting because‚Ä¶‚Äù Optional daily check.'},
{id:11,mode_id:4,name:'Expansion Map',tag:'Grow with intention',icon:'üå±',summary:'Define one area to expand, one to sustain, and one to rest.',instructions:'Choose: Expand like movement minutes. Sustain like sleep window. Rest like pausing an obligation. Review weekly.'},
{id:12,mode_id:4,name:'Skill Sprint',tag:'10-day micro-upgrade',icon:'üö¥',summary:'A tiny focused sprint that raises your ceiling without burnout.',instructions:'Pick one ten-minute skill or habit like mobility, meal prep, or breathwork. Start a timer, do it, mark done.'},
{id:13,mode_id:4,name:'Progress Pulse',tag:'Celebrate and iterate',icon:'üìà',summary:'A quick weekly review to lock in gains and choose the next nudge.',instructions:'Log your best win, biggest drain, and one tweak for next week. End with ‚ÄúNext nudge = ‚Ä¶‚Äù'},
{id:14,mode_id:4,name:'Support Loop',tag:'Grow with a buddy',icon:'ü§ù',summary:'Light accountability with one person.',instructions:'Choose a buddy. Agree on one weekly touch like a Friday text or Sunday walk. Add a reminder. Celebrate small wins.'},
];

const QuickWins=[
 {title:'Drink water',desc:'One full glass now. Feel the shift.',icon:'üíß'},
 {title:'Step outside',desc:'Three minutes of daylight or fresh air.',icon:'üåû'},
 {title:'Stretch overhead',desc:'Thirty seconds. Shoulders down, jaw loose.',icon:'ü§∏'},
 {title:'Phone-free pause',desc:'Put it in another room for five minutes.',icon:'üìµ'},
 {title:'Tidy one surface',desc:'Desk, bag, or car door pocket.',icon:'üßΩ'},
 {title:'Message a friend',desc:'One genuine check-in.',icon:'üí¨'}
];

/* ---------- HELPERS ---------- */
const app=document.getElementById('app');
const toastEl=document.getElementById('toast');
const showToast=(msg)=>{toastEl.textContent=msg;toastEl.classList.add('show');setTimeout(()=>toastEl.classList.remove('show'),1400);};
const setActive=()=>{
  document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('active'));
  const map={'#/home':'nav-home','#/wins':'nav-wins','#/about':'nav-about','#/history':'nav-history'};
  (document.getElementById(map[location.hash]||'nav-home')||{}).classList?.add('active');
};
const getLogs=()=>JSON.parse(localStorage.getItem('rc_logs')||'[]');
const saveLogs=(arr)=>localStorage.setItem('rc_logs',JSON.stringify(arr));
const addLog=({mode,tool,note})=>{
  const arr=getLogs();
  arr.push({ts:new Date().toISOString(),mode,tool,note:(note||'').trim()});
  saveLogs(arr);
};
const formatTS=(iso)=>new Date(iso).toLocaleString();
const ymd=(d)=>d.toISOString().slice(0,10);
function todayCount(){ const today=ymd(new Date()); return getLogs().filter(l=>l.ts.slice(0,10)===today).length; }
function dailyStreak(){ const dates=new Set(getLogs().map(l=>l.ts.slice(0,10))); let s=0; let d=new Date(); while(dates.has(ymd(d))){s++; d.setDate(d.getDate()-1);} return s; }

/* Scroll textareas above keyboard on iOS */
function attachFocusScroll(){
  document.querySelectorAll('textarea, input[type="text"]').forEach(el=>{
    el.addEventListener('focus',()=>{ setTimeout(()=>el.scrollIntoView({behavior:'smooth',block:'center'}),150); });
  });
}

/* PWA install prompt */
let deferredPrompt=null;
const installBtn=document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.hidden=false;
});
installBtn?.addEventListener('click', async ()=>{
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt=null;
  installBtn.hidden=true;
  showToast('App install started');
});

/* ---------- VIEWS ---------- */
function Home(){
  setActive();
  const tCount=todayCount(), streak=dailyStreak();
  app.innerHTML = `
    <div class="stats" role="status" aria-live="polite">
      <div class="stat">Today: <strong>${tCount}</strong></div>
      <div class="stat">Daily streak: <strong>${streak}</strong></div>
    </div>

    <div class="card instructions" style="text-align:left">
      <div style="display:grid;gap:6px">
        <div><b style="color:var(--surv)">ü©∫ Surviving:</b> running on empty</div>
        <div><b style="color:var(--drift)">üß≠ Drifting:</b> okay but unfocused</div>
        <div><b style="color:var(--ground)">üåø Grounded:</b> steady and consistent</div>
        <div><b style="color:var(--grow)">üöÄ Growing:</b> ready to push a little</div>
      </div>
      <p style="margin-top:10px;font-weight:700;color:var(--brand)">
        Not sure? Start with <span style="color:var(--drift)">Drifting</span>.
      </p>
    </div>

    <div class="compass-wrap" aria-label="Mode Compass">
      <svg class="compass" viewBox="0 0 200 200" role="img" aria-label="Choose a mode">
        <defs>
          <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity=".2"/>
          </filter>
        </defs>

        <circle cx="100" cy="100" r="96" fill="#fff" stroke="var(--brand)" stroke-width="3" filter="url(#softShadow)"/>
        <!-- Quadrants -->
        <path class="wedge" d="M100,100 L100,4 A96,96 0 0,1 196,100 Z" fill="var(--surv)"  opacity=".18" onclick="location.hash='#/mode/1'"></path>
        <path class="wedge" d="M100,100 L196,100 A96,96 0 0,1 100,196 Z" fill="var(--drift)" opacity=".18" onclick="location.hash='#/mode/2'"></path>
        <path class="wedge" d="M100,100 L100,196 A96,96 0 0,1 4,100 Z"  fill="var(--ground)" opacity=".18" onclick="location.hash='#/mode/3'"></path>
        <path class="wedge" d="M100,100 L4,100 A96,96 0 0,1 100,4 Z"   fill="var(--grow)"  opacity=".18" onclick="location.hash='#/mode/4'"></path>

        <circle cx="100" cy="100" r="7" fill="var(--brand)"></circle>

        <!-- Labels -->
        <text x="135" y="65"  text-anchor="middle" fill="var(--surv)"  font-size="12">Surviving</text>
        <text x="135" y="135" text-anchor="middle" fill="var(--drift)" font-size="12">Drifting</text>
        <text x="65"  y="135" text-anchor="middle" fill="var(--ground)" font-size="12">Grounded</text>
        <text x="65"  y="65"  text-anchor="middle" fill="var(--grow)"  font-size="12">Growing</text>
      </svg>
      <p class="center-tip">Tap a wedge or use the buttons below.</p>
    </div>

    <div class="mode-buttons">
      <div class="mode-btn surv"   onclick="location.hash='#/mode/1'"><span>ü©∫ Surviving</span></div>
      <div class="mode-btn drift"  onclick="location.hash='#/mode/2'"><span>üß≠ Drifting</span></div>
      <div class="mode-btn ground" onclick="location.hash='#/mode/3'"><span>üåø Grounded</span></div>
      <div class="mode-btn grow"   onclick="location.hash='#/mode/4'"><span>üöÄ Growing</span></div>
    </div>
  `;
}

function ModeView(id){
  setActive();
  const m=Modes.find(x=>x.id==id); if(!m){location.hash='#/home';return}
  const list=Tools.filter(t=>t.mode_id==m.id);
  app.innerHTML=`
    <div class="pill" style="margin-bottom:8px;background:${m.color}20;color:${m.color}">${m.icon} ${m.name}</div>
    <h2>${m.name}</h2>
    <p class="muted" style="margin-top:-6px">${m.desc}</p>
    <div class="grid">
      ${list.map(t=>`
        <div class="card">
          <div class="pill">${t.icon} ${t.tag}</div>
          <h3>${t.name}</h3>
          <p class="muted">${t.summary}</p>
          <div style="height:8px"></div>
          <a class="btn" href="#/tool/${t.id}">Open</a>
        </div>`).join('')}
    </div>
    <div class="sticky-back">
      <a class="btn ghost" href="#/home">Back to Compass</a>
    </div>
  `;
}

function ToolView(id){
  setActive();
  const t=Tools.find(x=>x.id==id); if(!t){location.hash='#/home';return}
  const m=Modes.find(x=>x.id==t.mode_id);
  app.innerHTML=`
    <div class="pill" style="margin-bottom:8px;background:${m.color}20;color:${m.color}">${m.icon} ${m.name}</div>
    <h2>${t.icon} ${t.name}</h2>
    <div class="card"><p class="muted">${t.summary}</p></div>

    <div class="card">
      <h3>How to use</h3>
      <ul style="margin:0;padding-left:18px">${t.instructions.split('. ').map(s=>s.trim()).filter(Boolean).map(s=>`<li>${s.replace(/\.$/,'')}.</li>`).join('')}</ul>
    </div>

    <div class="card">
      <h3>Write a quick note (optional)</h3>
      <p class="muted" style="margin-top:-6px">One sentence is enough. You‚Äôll see it in your History.</p>
      <textarea id="noteBox" placeholder="What did you do or notice? (e.g., ‚Äú2-min breath: felt calmer.‚Äù)"></textarea>
      <div style="height:10px"></div>
      <button class="btn" id="saveAndLog" aria-label="Save note and log completion">Save note + Did it ‚úÖ</button>
      <button class="btn subtle" id="logOnly" style="margin-left:8px" aria-label="Log completion without a note">Did it ‚úÖ (no note)</button>
    </div>

    <div class="sticky-back">
      <a class="btn ghost" href="#/mode/${m.id}">Back to ${m.name}</a>
    </div>
  `;
  attachFocusScroll();
  const noteEl=document.getElementById('noteBox');
  document.getElementById('saveAndLog').onclick=()=>{ addLog({mode:m.name,tool:t.name,note:noteEl.value}); showToast('Saved to History'); };
  document.getElementById('logOnly').onclick=()=>{ addLog({mode:m.name,tool:t.name,note:''}); showToast('Logged'); };
}

function Wins(){
  setActive();
  const recent=getLogs().slice(-10).reverse();
  app.innerHTML = `
    <h2>Quick Wins</h2>
    <div class="grid">
      ${QuickWins.map((w,i)=>`
        <div class="card" id="qw-${i}">
          <div class="pill">${w.icon} Quick Win</div>
          <h3 style="margin-top:6px">${w.title}</h3>
          <p class="muted">${w.desc}</p>
          <div style="margin-top:8px">
            <textarea id="note-${i}" placeholder="Optional: jot a sentence about what you did or noticed."></textarea>
            <div style="height:8px"></div>
            <button class="btn" onclick="(function(){
              const el=document.getElementById('note-${i}');
              const note=(el.value||'').trim();
              addLog({mode:'Quick Win',tool:'${w.title.replace(/'/g,"&#39;")}',note});
              document.querySelector('#qw-${i} .pill').innerHTML='‚úÖ Logged';
              showToast('Saved to History');
            })()">Save note + Done</button>
            <button class="btn subtle" style="margin-left:8px" onclick="(function(){
              addLog({mode:'Quick Win',tool:'${w.title.replace(/'/g,"&#39;")}',note:''});
              document.querySelector('#qw-${i} .pill').innerHTML='‚úÖ Logged';
              showToast('Logged');
            })()">Done (no note)</button>
          </div>
        </div>
      `).join('')}
    </div>

    <div style="height:12px"></div>
    <div class="card">
      <strong>Recent logs</strong>
      ${recent.length
        ? `<ul style="margin:8px 0 0 18px">
             ${recent.map(l=>`<li>${new Date(l.ts).toLocaleString()} ‚Äî <strong>${l.tool}</strong> (${l.mode}) ${l.note?`‚Äî ${l.note.replace(/</g,'&lt;')}`:''}</li>`).join('')}
           </ul>`
        : `<p class="muted">No logs yet.</p>`
      }
      <div style="height:10px"></div>
      <a class="btn ghost" href="#/history">Open full History</a>
      <a class="btn ghost" style="margin-left:8px" href="#/home">Back to Compass</a>
    </div>
  `;
  attachFocusScroll();
}

function History(){
  setActive();
  const logs=getLogs().reverse();
  const uniqueModes=['All','Surviving','Drifting','Grounded','Growing','Quick Win'];
  app.innerHTML=`
    <h2>History</h2>
    <div class="card">
      <div class="filters">
        <label class="visually-hidden" for="modeFilter">Filter by mode</label>
        <select id="modeFilter" aria-label="Filter by mode">${uniqueModes.map(m=>`<option value="${m}">${m}</option>`).join('')}</select>
        <input type="text" id="searchBox" placeholder="Search notes or tools" aria-label="Search notes or tools"/>
        <span class="badge">${logs.length} entries</span>
        <button class="btn ghost" id="clearLogs">Clear All</button>
      </div>
      <div class="stats">
        <div class="stat">Today: <strong>${todayCount()}</strong></div>
        <div class="stat">Daily streak: <strong>${dailyStreak()}</strong></div>
      </div>
      <div id="logList">${renderLogs(logs)}</div>
      <div class="sticky-back">
        <a class="btn ghost" href="#/home">Back to Compass</a>
      </div>
    </div>
  `;
  document.getElementById('clearLogs').onclick=()=>{
    if(confirm('Clear all local history on this device?')){
      saveLogs([]); showToast('History cleared'); History();
    }
  };
  document.getElementById('modeFilter').onchange = applyFilters;
  document.getElementById('searchBox').oninput = applyFilters;
  function applyFilters(){
    const mf=document.getElementById('modeFilter').value;
    const q=(document.getElementById('searchBox').value||'').toLowerCase();
    const filtered=logs.filter(l=>{
      const mOk=(mf==='All'||l.mode===mf);
      const qOk=(!q || (l.tool.toLowerCase().includes(q) || (l.note||'').toLowerCase().includes(q)));
      return mOk && qOk;
    });
    document.getElementById('logList').innerHTML=renderLogs(filtered);
  }
}
function renderLogs(list){
  if(!list.length) return `<p class="muted">No entries yet.</p>`;
  return list.map(l=>`
    <div class="log-item">
      <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <div><strong>${l.tool}</strong> <span class="badge">${l.mode}</span></div>
        <div class="muted" style="font-size:12px">${formatTS(l.ts)}</div>
      </div>
      ${l.note?`<div class="note" style="margin-top:6px">${(l.note||'').replace(/</g,'&lt;')}</div>`:''}
    </div>
  `).join('');
}

function About(){
  setActive();
  app.innerHTML=`
    <h2>About</h2>
    <div class="card">
      <p><strong>The Reset Compass</strong> helps you take your health into your own hands right now. Pick your current mode and get steps that match your energy.</p>
      <p class="muted" style="font-size:12px">Disclaimer: This companion is for educational purposes only and is not medical advice. Consult a qualified provider before changing your routine.</p>
      <p class="muted" style="font-size:12px">Support: evolutionofwellness8@gmail.com</p>
      <div class="sticky-back">
        <a class="btn ghost" href="#/home">Back to Compass</a>
      </div>
    </div>
  `;
}

/* ---------- ROUTER & INIT ---------- */
function router(){
  const r=location.hash.replace('#','')||'/home';
  if(r.startsWith('/mode/')) return ModeView(r.split('/')[2]);
  if(r.startsWith('/tool/')) return ToolView(r.split('/')[2]);
  if(r==='/wins') return Wins();
  if(r==='/history') return History();
  if(r==='/about') return About();
  return Home();
}
window.addEventListener('hashchange',router);
window.addEventListener('load',()=>{
  router();

  // Welcome popup (one-time)
  if(!localStorage.getItem('welcomeSeen')){
    const el=document.createElement('div');
    el.id='popup';
    el.innerHTML=`<div class="box" role="dialog" aria-modal="true" aria-label="Welcome">
      <h3 style="margin-top:0">Welcome</h3>
      <p>Pick a mode and take one step that fits your day.</p>
      <button class="btn" id="startBtn" aria-label="Start using the app">Start</button>
      <p style="font-size:12px;color:#6b6b6b;margin:6px 0 0">Your history saves to this device.</p>
    </div>`;
    document.body.appendChild(el);
    document.getElementById('startBtn').onclick=()=>{localStorage.setItem('welcomeSeen','true');el.remove();};
  }

  // Service worker (bumped to v105)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js?v=105').catch(() => {});
  }
});
</script>
</body>
</html>
